{% extends "base.html" %}

{% block title %}管理面板 - 电商产品管理系统{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-cogs"></i> 管理面板</h2>
</div>

<!-- 用户管理 -->
<div class="card mb-4">
    <div class="card-header">
        <h5><i class="fas fa-users"></i> 用户管理</h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>用户ID</th>
                        <th>用户名</th>
                        <th>管理员</th>
                        <th>注册时间</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr>
                        <td>{{ user.user_id }}</td>
                        <td>{{ user.username }}</td>
                        <td>
                            <span class="badge bg-{% if user.is_admin %}warning{% else %}secondary{% endif %}">
                                {% if user.is_admin %}是{% else %}否{% endif %}
                            </span>
                        </td>
                        <td>{{ user.created_at[:19].replace('T', ' ') }}</td>
                        <!-- 重置密码按钮（仅管理员可见） -->
                        {% if session.username == 'Ycitus' %}
                        <td>
                            <form action="{{ url_for('reset_password', user_id=user.user_id) }}" method="post" style="display: inline;">
                                <button type="submit" class="btn btn-warning btn-sm">
                                    <i class="fas fa-key"></i> 重置密码
                                </button>
                            </form>
                        </td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- 权限组管理 -->
<div class="card mb-4">
    <div class="card-header">
        <h5><i class="fas fa-user-tag"></i> 权限组管理</h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>组ID</th>
                        <th>组名称</th>
                        <th>描述</th>
                        <th>创建时间</th>
                    </tr>
                </thead>
                <tbody>
                    {% for group in groups %}
                    <tr>
                        <td>{{ group.group_id }}</td>
                        <td>{{ group.group_name }}</td>
                        <td>{{ group.description or '无' }}</td>
                        <td>{{ group.created_at[:19].replace('T', ' ') }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- 用户组关联 -->
<div class="card">
    <div class="card-header">
        <h5><i class="fas fa-link"></i> 用户组关联</h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>用户</th>
                        <th>组名称</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user_group in user_groups_data %}
                    <tr>
                        <td>{{ user_group.username }}</td>
                        <td>{{ user_group.group_name }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>


<!-- 数据库备份 -->
<div class="card">
    <div class="card-header">
        <h5><i class="fas fa-database"></i> 数据备份</h5>
    </div>
    <div class="card-body">
        <a href="{{ url_for('manual_backup') }}" class="btn btn-warning">
            <i class="fas fa-database"></i> 手动备份数据库
        </a>
        <a href="{{ url_for('get_lingxing_excel_all') }}" class="btn btn-warning">
            <i class="fas fa-file-export"></i> 导出所有产品
        </a>
    </div>
</div>
{% endblock %}
